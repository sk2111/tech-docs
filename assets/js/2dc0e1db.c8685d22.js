"use strict";(self.webpackChunktech_docs=self.webpackChunktech_docs||[]).push([[3416],{464:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s_secret_5-69ec98d609f1edcf57aeb1eb61a189ec.png"},1641:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s_secret_4-278fa331288bb7d24185028fc1ad8407.png"},1810:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s_secret_pat_1-ce824eabc2c92eed39a3001321a6e3c7.png"},1846:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s_secret_pat-0fb12f478a19a34da147adcfe9dd3c62.png"},3175:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s_secret_1-9efaefb034b731f250613538f419bbda.png"},7787:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"tech/devops/Section 3/slide3","title":"K8\'s Secrets","description":"1. In K8\'s, Secrets are used to store sensitive information such as passwords, OAuth tokens, and ssh keys.","source":"@site/docs/tech/devops/Section 3/slide3.md","sourceDirName":"tech/devops/Section 3","slug":"/tech/devops/Section 3/slide3","permalink":"/tech-docs/docs/tech/devops/Section 3/slide3","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tech/devops/Section 3/slide3.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"K8\'s Secrets"},"sidebar":"techDocsSidebar","previous":{"title":"K8\'s Config Maps","permalink":"/tech-docs/docs/tech/devops/Section 3/slide2"},"next":{"title":"K8\'s Scaling & Resource","permalink":"/tech-docs/docs/tech/devops/Section 3/slide4"}}');var t=s(4848),a=s(8453);const c={sidebar_position:2,sidebar_label:"K8's Secrets"},i="K8's Secrets",l={},o=[{value:"Lets see an example",id:"lets-see-an-example",level:2},{value:"Let&#39;s create a new deployment",id:"lets-create-a-new-deployment",level:2},{value:"Create a Opaque secret",id:"create-a-opaque-secret",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"k8s-secrets",children:"K8's Secrets"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"In K8's, Secrets are used to store sensitive information such as passwords, OAuth tokens, and ssh keys."}),"\n",(0,t.jsx)(n.li,{children:"Secrets are similar to ConfigMaps but are specifically designed to hold confidential data."}),"\n",(0,t.jsx)(n.li,{children:"Secrets are stored in an encoded format (base64) to provide a basic level of security."}),"\n",(0,t.jsx)(n.li,{children:"We have multiple types of secrets like Opaque, Docker Registry, TLS, basic, ssh, k8's token etc."}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Important"}),": While Secrets provide a basic level of security by encoding the data, they are not encrypted by default."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"important",children:(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["With native K8's ",(0,t.jsx)(n.strong,{children:"secrets are not encrypted by default"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"For enhanced security, consider using additional encryption mechanisms or tools like K8's Encryption at Rest or  external secret management solutions."}),"\n",(0,t.jsx)(n.li,{children:"Always follow best practices for managing sensitive data in your applications."}),"\n",(0,t.jsx)(n.li,{children:"In real projects, we store secrets in external secret management tools like HashiCorp Vault, AWS Secrets Manager, Azure Key Vault, Github Secrets, etc., and inject them into K8's at runtime."}),"\n",(0,t.jsx)(n.li,{children:"Managed K8's services like GKE, EKS, AKS provide integration with their respective secret management services for better security."}),"\n"]})}),"\n",(0,t.jsx)(n.h2,{id:"lets-see-an-example",children:"Lets see an example"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Till now we pulled the docker images from public docker hub repos. But in real time scenarios, we may have private docker repos to store our docker images."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Lets first create a private repo in docker hub & push a sample private docker image. Go to docker hub & create a new private repo."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"You can push the backend service image from earlier section practice to the private repo."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.img,{alt:"k8s_secrets_1",src:s(3175).A+"",width:"873",height:"220"}),"\r\n",(0,t.jsx)(n.img,{alt:"k8s_secrets_2",src:s(9119).A+"",width:"1867",height:"652"})]}),"\n",(0,t.jsx)(n.h2,{id:"lets-create-a-new-deployment",children:"Let's create a new deployment"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Let's clean up all the existing deployments & services from previous practice."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"kubectl delete deployment <name-of-deployment>\r\nkubectl delete service <name-of-service>\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Now lets replace the deployment image with the private image from docker hub."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n    name: node-app\r\n    labels:\r\n        app: node-app\r\nspec:\r\n    replicas: 3\r\n    selector:\r\n        matchLabels:\r\n            app: node-app\r\n    template:\r\n        metadata:\r\n        labels:\r\n            app: node-app\r\n        spec:\r\n        containers:\r\n            - image: sathish1996/private-repo:1.1.1\r\n            name: node-app\r\n            ports:\r\n                - containerPort: 4000\r\n            envFrom:\r\n                - configMapRef:\r\n                    name: app-config\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Apply the deployment using the below command"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl apply -f deployment.yaml\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["You will notice the pods will be in ",(0,t.jsx)(n.code,{children:"ErrorImagePull"})," state because K8's is not able to pull the private image without authentication."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl get pods\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Analyse the error using the below command"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl describe pod <pod-name>\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"To fix this issue, we need to create a secret with docker registry credentials and link it to the deployment."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Lets go to docker hub and create a PAT (Personal Access Token) for authentication.\r\n",(0,t.jsx)(n.img,{alt:"k8s_secret_pat",src:s(1846).A+"",width:"1886",height:"293"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create a docker secret using the below command"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl create secret docker-registry my-private-secret --docker-email=your@gmail.com --docker-username=your-username --docker-password=your-docker-pat --docker-server=https://index.docker.io/v2/\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"k8s_secret_pat_1",src:s(1810).A+"",width:"1268",height:"75"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Verify the secret is created using the below command"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl get secrets\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Now update the deployment yaml to include the imagePullSecrets section as shown below\r\n",(0,t.jsx)(n.img,{alt:"k8s_secret_4",src:s(1641).A+"",width:"675",height:"460"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Redeploy the deployment using the below command"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl apply -f deployment.yaml\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"12",children:["\n",(0,t.jsx)(n.li,{children:"Verify the pods are created and running using the below command"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl get pods\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"13",children:["\n",(0,t.jsx)(n.li,{children:"Access the application using the service & minikube service URL & verify the app is working fine in browser."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"create-a-opaque-secret",children:"Create a Opaque secret"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Opaque type Secrets can be created using yaml files."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"    apiVersion: v1\r\n    kind: Secret\r\n    metadata:\r\n        name: app-secret\r\n    type: Opaque\r\n    data:\r\n        DB_PASSWORD: cGFzc3dvcmQxMjM=  # base64 encoded value of 'password123'\r\n        API_KEY: YXBpa2V5MTIzNDU2  # base64 encoded value of 'apikey123456'\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Apply the secret using the below command"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl apply -f secret.yaml\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Verify whether the secret is created using the below command"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl get secrets\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Now update the deployment yaml to use the secret as shown below"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n    name: node-app\r\n    labels:\r\n        app: node-app\r\nspec:\r\n    replicas: 3\r\n    selector:\r\n        matchLabels:\r\n            app: node-app\r\n    template:\r\n        metadata:\r\n        labels:\r\n            app: node-app\r\n        spec:\r\n        containers:\r\n            - image: sathish1996/private-repo:1.1.1\r\n            name: node-app\r\n            ports:\r\n                - containerPort: 4000\r\n            envFrom:\r\n                - configMapRef:\r\n                    name: app-config\r\n                - secretRef:\r\n                    name: app-secret\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"This will pass all the key value pairs from the secret as environment variables to the pod."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Apply the deployment using the below command"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl apply -f deployment.yaml\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Verify the pods are recreated using the below command"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl get pods\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Use the below command to exec into the pod and verify the secret values are available as environment variables"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" kubectl exec -it <pod-name> -- sh\r\n\r\n printenv\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:" minikube kubectl -- exec -it <pod-name> -- sh\r\n\r\n printenv\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"k8s_secret_5",src:s(464).A+"",width:"1072",height:"710"})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var r=s(6540);const t={},a=r.createContext(t);function c(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(a.Provider,{value:n},e.children)}},9119:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s_secret_2-01a0946481cd0a46e710e995cf0ca009.png"}}]);