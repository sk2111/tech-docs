"use strict";(self.webpackChunktech_docs=self.webpackChunktech_docs||[]).push([[7996],{5389:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"tech/devops/Section 4/slide1","title":"K8\'s Volumes","description":"1. In K8\'s we have both ephemeral and persistent volumes.","source":"@site/docs/tech/devops/Section 4/slide1.md","sourceDirName":"tech/devops/Section 4","slug":"/tech/devops/Section 4/slide1","permalink":"/tech-docs/docs/tech/devops/Section 4/slide1","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tech/devops/Section 4/slide1.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"K8\'s Volumes"},"sidebar":"techDocsSidebar","previous":{"title":"K8\'s Recap","permalink":"/tech-docs/docs/tech/devops/Section 3/slide5"},"next":{"title":"K8\'s Additional Concepts","permalink":"/tech-docs/docs/tech/devops/Section 4/slide2"}}');var r=s(4848),t=s(8453);const a={sidebar_position:1,sidebar_label:"K8's Volumes"},l="K8's Volumes",c={},d=[{value:"Ephemeral Volumes - emptyDir",id:"ephemeral-volumes---emptydir",level:2},{value:"Persistent Volumes &amp; Persistent Volume Claims",id:"persistent-volumes--persistent-volume-claims",level:2},{value:"Static &amp; Dynamic Provisioning",id:"static--dynamic-provisioning",level:2},{value:"Reclaim Policy",id:"reclaim-policy",level:2},{value:"Practice Time (PV &amp; PVC)",id:"practice-time-pv--pvc",level:2}];function o(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"k8s-volumes",children:"K8's Volumes"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["In K8's we have both ",(0,r.jsx)(n.code,{children:"ephemeral"})," and ",(0,r.jsx)(n.code,{children:"persistent"})," volumes."]}),"\n",(0,r.jsx)(n.li,{children:"Ephemeral volumes are temporary and are deleted when the pod is deleted."}),"\n",(0,r.jsx)(n.li,{children:"Persistent volumes are long-lasting and can be reused by different pods &\r\nprovide persistent storage."}),"\n",(0,r.jsx)(n.li,{children:"Volumes allow data to persist beyond the lifecycle of a pod, enabling data\r\nsharing between containers in a pod and across pod restarts."}),"\n",(0,r.jsxs)(n.li,{children:["K8's supports various types of volumes like ",(0,r.jsx)(n.code,{children:"emptyDir"}),", ",(0,r.jsx)(n.code,{children:"hostPath"}),",\r\n",(0,r.jsx)(n.code,{children:"StorageClass"})," etc."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"ephemeral-volumes---emptydir",children:"Ephemeral Volumes - emptyDir"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"emptyDir"})," is a type of ephemeral volume that is created when a pod is\r\nassigned to a node and exists as long as the pod is running on that node."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Data in an ",(0,r.jsx)(n.code,{children:"emptyDir"})," volume is stored on the node's filesystem and is\r\ndeleted when the pod is removed from the node."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"emptyDir"})," volumes are useful for temporary storage of data that does not\r\nneed to persist beyond the lifecycle of the pod."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Below is an example of how to use ",(0,r.jsx)(n.code,{children:"emptyDir"})," volume in a pod specification."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: emptydir-app\r\n  labels:\r\n    app: emptydir-app\r\nspec:\r\n  volumes:\r\n    - name: emptydir-volume\r\n      emptyDir: {}\r\n  containers:\r\n    - name: busybox\r\n      image: busybox\r\n      command: ["sh", "-c", "sleep 3600"]\r\n      volumeMounts:\r\n        - name: emptydir-volume\r\n          mountPath: /data\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["In the above example, we have created a pod named ",(0,r.jsx)(n.code,{children:"emptydir-app"})," with an\r\n",(0,r.jsx)(n.code,{children:"emptyDir"})," volume named ",(0,r.jsx)(n.code,{children:"emptydir-volume"}),". The container writes a file\r\n",(0,r.jsx)(n.code,{children:"hello.txt"})," to the ",(0,r.jsx)(n.code,{children:"/data"})," directory, which is mounted to the ",(0,r.jsx)(n.code,{children:"emptyDir"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Let's see how to create a pod with an ",(0,r.jsx)(n.code,{children:"emptyDir"})," volume and verify its\r\nfunctionality."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl apply -f emptydir-pod.yaml\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Once the pod is running, we can exec into the container and create a file\r\nin the ",(0,r.jsx)(n.code,{children:"emptyDir"})," volume."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'kubectl exec -it emptydir-app -- sh\r\necho "Hello, World!" > /data/hello.txt\r\nexit\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Now, if we delete the pod and recreate it, we will see that the file\r\n",(0,r.jsx)(n.code,{children:"hello.txt"})," is no longer present, demonstrating the ephemeral nature of\r\n",(0,r.jsx)(n.code,{children:"emptyDir"})," volumes."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl delete pod emptydir-app\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl apply -f emptydir-pod.yaml\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl exec -it emptydir-app -- sh\r\nls /data\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"persistent-volumes--persistent-volume-claims",children:"Persistent Volumes & Persistent Volume Claims"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Persistent Volumes (PVs) are a way to provide persistent storage in K8's."}),"\n",(0,r.jsx)(n.li,{children:"PVs are created by administrators."}),"\n",(0,r.jsx)(n.li,{children:"Persistent Volume Claims (PVCs) are requests for storage by users. PVCs can\r\nspecify size, access modes, and storage class."}),"\n",(0,r.jsx)(n.li,{children:"It claims a piece of storage from a PV and binds to it."}),"\n",(0,r.jsx)(n.li,{children:"K8's Controller manages the binding between PVs and PVCs."}),"\n",(0,r.jsxs)(n.li,{children:["Access modes define how the volume can be mounted (e.g., ",(0,r.jsx)(n.code,{children:"ReadWriteOnce, ReadOnlyMany, ReadWriteMany"}),")."]}),"\n",(0,r.jsx)(n.li,{children:"Both the PV and PVC must have compatible access modes for successful binding."}),"\n",(0,r.jsxs)(n.li,{children:["Example you cannot bind a PV with ",(0,r.jsx)(n.code,{children:"ReadWriteOnce"})," access mode to a PVC\r\nrequesting ",(0,r.jsx)(n.code,{children:"ReadOnlyMany"})," access mode."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"k8s_pv_1",src:s(5565).A+"",width:"667",height:"612"})}),"\n",(0,r.jsx)(n.h2,{id:"static--dynamic-provisioning",children:"Static & Dynamic Provisioning"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"In static provisioning, an administrator creates a set of PVs that users\r\ncan claim."}),"\n",(0,r.jsx)(n.li,{children:"In dynamic provisioning, K8's automatically provisions a PV when a PVC is\r\ncreated, based on the storage class specified in the PVC."}),"\n",(0,r.jsxs)(n.li,{children:["Dynamic provisioning requires a ",(0,r.jsx)(n.code,{children:"storage class"})," to be defined in the cluster."]}),"\n",(0,r.jsxs)(n.li,{children:["When a PVC is created with a specific ",(0,r.jsx)(n.code,{children:"storage class"}),", K8's uses the\r\nprovisioner defined in that storage class to create a new PV that meets\r\nthe PVC's requirements."]}),"\n",(0,r.jsx)(n.li,{children:"Storage classes contains the provisioner information and parameters needed for\r\ndynamic provisioning."}),"\n",(0,r.jsxs)(n.li,{children:["Provisioners like ",(0,r.jsx)(n.code,{children:"kubernetes.io/aws-ebs"}),", ",(0,r.jsx)(n.code,{children:"kubernetes.io/gce-pd"}),", etc. are\r\nused to create PVs on different cloud providers."]}),"\n",(0,r.jsxs)(n.li,{children:["Storage classes has other parameters like ",(0,r.jsx)(n.code,{children:"reclaim policy"}),", ",(0,r.jsx)(n.code,{children:"volume binding mode"}),",\r\netc. that define the behavior of the provisioned PVs."]}),"\n",(0,r.jsx)(n.li,{children:"Storage classes also defines the type of storage (e.g., SSD, HDD)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"reclaim-policy",children:"Reclaim Policy"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Now let's say you don't need a PVC anymore, what happens to it?"}),"\n",(0,r.jsx)(n.li,{children:"Reclaim policy defines what happens to a PV when its bound PVC is deleted."}),"\n",(0,r.jsxs)(n.li,{children:["Common reclaim policies are ",(0,r.jsx)(n.code,{children:"Retain"})," & ",(0,r.jsx)(n.code,{children:"Delete"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Retain"})," keeps the PV and its data intact for manual reclamation. Data is\r\npreserved."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Delete"})," removes the PV and its data from the cluster. Data is lost.\r\nNot recommended for production."]}),"\n",(0,r.jsx)(n.li,{children:"The reclaim policy is set when the PV is created and can be modified later\r\nif needed."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"practice-time-pv--pvc",children:"Practice Time (PV & PVC)"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"As we are in local minikube, Let's try the to create a\r\npersistent volume in minikube nodes."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"First let ssh into minikube node to create a directory for volume."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"minikube ssh -n=minikube-m02\r\nsudo mkdir -p /mnt/data\r\nsudo chmod 777 /mnt/data\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Let's go inside the ",(0,r.jsx)(n.code,{children:"mnt/data"})," directory and create a file to verify\r\npersistence."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'cd /mnt/data\r\necho "Persistent Data" > index.html\r\nexit\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Repeat the above step for minikube-m03 node as well."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"First let's create a persistent volume using hostPath volume type."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: PersistentVolume\r\nmetadata:\r\n  name: pv-volume\r\nspec:\r\n  storageClassName: standard\r\n  capacity:\r\n    storage: 1Gi\r\n  accessModes:\r\n    - ReadWriteOnce\r\n  hostPath:\r\n    path: "/mnt/data"\r\n  persistentVolumeReclaimPolicy: Retain\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Now apply the above PV configuration."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl apply -f pv.yaml\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Verify the PV status."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl get pv\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"k8s_pv_2",src:s(8150).A+"",width:"1612",height:"117"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Now let's create a persistent volume claim to claim the above created PV."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: PersistentVolumeClaim\r\nmetadata:\r\n  name: pvc-volume-claim\r\nspec:\r\n  storageClassName: standard\r\n  accessModes:\r\n    - ReadWriteOnce\r\n  resources:\r\n    requests:\r\n      storage: 500Mi\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Now apply the above PVC configuration."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl apply -f pvc.yaml\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Verify the PV and PVC status."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl get pv\r\nkubectl get pvc\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"k8s_pv_3",src:s(6895).A+"",width:"1602",height:"77"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"You should see that the PVC is bound to the PV."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Finally, let's create a pod that uses the above created PVC."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: nginx-app\r\n  labels:\r\n    app: nginx-app\r\nspec:\r\n  volumes:\r\n    - name: nginx-storage\r\n      persistentVolumeClaim:\r\n        claimName: pvc-volume-claim\r\n  containers:\r\n    - name: nginx\r\n      image: nginx\r\n      volumeMounts:\r\n        - name: nginx-storage\r\n          mountPath: /usr/share/nginx/html\r\n      ports:\r\n        - containerPort: 80\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Now apply the above pod configuration."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl apply -f pod.yaml\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Now let's verify if the data is persistent by accessing the nginx server."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl port-forward pod/nginx-app 8080:80\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Open your browser and navigate to ",(0,r.jsx)(n.code,{children:"http://localhost:8080"}),' to see the\r\n"Persistent Data" content.']}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Now delete the pod and recreate it to verify data persistence."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl delete pod nginx-app\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl apply -f nginx-pod.yaml\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl port-forward pod/nginx-app 8080:80\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Open your browser again and navigate to ",(0,r.jsx)(n.code,{children:"http://localhost:8080"}),' to see that\r\nthe "Persistent Data" content is still there, confirming that the data\r\npersisted across pod restarts or deletions.']}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{title:"PRODUCTION TIP",type:"tip",children:(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["In production environments, it is recommended to use ",(0,r.jsx)(n.code,{children:"Persistent Volumes"}),"\r\nand ",(0,r.jsx)(n.code,{children:"Persistent Volume Claims"})," for managing storage needs of applications."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"Dynamic Provisioning"})," with appropriate ",(0,r.jsx)(n.code,{children:"Storage Classes"})," to automate\r\nthe creation of persistent volumes based on application requirements."]}),"\n",(0,r.jsxs)(n.li,{children:["Set the ",(0,r.jsx)(n.code,{children:"Reclaim Policy"})," of persistent volumes based on data retention\r\nneeds. Use ",(0,r.jsx)(n.code,{children:"Retain"})," for critical data that needs to be preserved even after\r\nthe PVC is deleted."]}),"\n",(0,r.jsx)(n.li,{children:"Regularly monitor and manage the storage resources to ensure optimal\r\nperformance and availability of applications."}),"\n"]})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},5565:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/k8s_pv_1-a796d5d48511cf187cbbd124c7ad2de4.png"},6895:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/k8s_pv_3-5b4212ea30b5d9ecde2d08baff9a2f16.png"},8150:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/k8s_pv_2-8fb69e773c469d84640072b35e4094c5.png"},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var i=s(6540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);